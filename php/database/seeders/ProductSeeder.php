<?php

namespace Database\Seeders;

use App\Models\Product;
use App\Models\ProductTranslation;
use App\Models\Workspace;
use Illuminate\Database\Seeder;
use Illuminate\Support\Str;

class ProductSeeder extends Seeder
{
    private array $categories = [
        'Жіночий одяг' => [
            ['Сукня вечірня з мереживом', 'Елегантна вечірня сукня з тонким мереживом та відкритою спиною. Ідеальна для урочистих заходів.'],
            ['Блуза шовкова класична', 'Легка шовкова блуза вільного крою з V-подібним вирізом. Підходить для офісу та відпочинку.'],
            ['Спідниця міді плісована', 'Стильна плісована спідниця довжиною міді. Виконана з легкої тканини, що плавно струменіє.'],
            ['Пальто вовняне оверсайз', 'Теплe вовняне пальто крою оверсайз у класичному бежевому кольорі. Підкладка на кнопках.'],
            ['Джинси скінні з розрізами', 'Облягаючі джинси з трендовими розрізами на колінах. Склад: 98% бавовна, 2% еластан.'],
            ['Светр вязаний з косами', 'Теплий в\'язаний светр з класичним візерунком "коси". М\'яка акрилова пряжа.'],
            ['Куртка шкіряна байкерська', 'Куртка з натуральної шкіри з асиметричною застібкою та металевими заклепками.'],
            ['Боді мереживне бежеве', 'Витончене боді з мереживними вставками. Ідеально під спідниці та брюки.'],
            ['Шорти джинсові варені', 'Короткі джинсові шорти з ефектом "варіння". Потерті краї, висока посадка.'],
            ['Топ рубчастий базовий', 'Базовий топ з рубчастого трикотажу. Є в 12 кольорах. Ідеальна база для будь-якого образу.'],
        ],
        'Чоловічий одяг' => [
            ['Сорочка лляна літня', 'Легка лляна сорочка для спекотного літа. Вільний крій, нагрудна кишеня.'],
            ['Брюки чінос slim-fit', 'Класичні чінос зі звуженим силуетом. Бавовняна тканина стрейч. 6 кольорів.'],
            ['Худі флісове з капюшоном', 'М\'яке флісове худі з великим капюшоном та кенгуру-кишенею. Тепле та зручне.'],
            ['Піджак класичний темно-синій', 'Строгий піджак з якісної вовняної суміші. Внутрішня підкладка, 2 гудзики.'],
            ['Футболка оверсайз принт', 'Футболка крою оверсайз з авторським графічним принтом. 100% бавовна преміум.'],
            ['Джинси прямі класичні', 'Класичні прямі джинси з твердого деніму. Вищена посадка, 5 кишень.'],
            ['Куртка вітрівка технічна', 'Легка вітрівка з водовідштовхуючим покриттям. Проклеєні шви, регульований капюшон.'],
            ['Светр мериносовий тонкий', 'Тонкий светр з 100% мериносової вовни. Не колеться, дихає, зберігає тепло.'],
            ['Шорти спортивні швидковисихаючі', 'Функціональні шорти для занять спортом. Внутрішня сітка, боковий карман на блискавці.'],
            ['Жилет стьобаний утеплений', 'Стьобаний жилет з утепленням. Легкий та теплий, підходить для міжсезоння.'],
        ],
        'Взуття жіноче' => [
            ['Туфлі на шпильці класичні', 'Класичні туфлі-човники на тонкій шпильці 10 см. Натуральна шкіра.'],
            ['Кросівки білі шкіряні', 'Мінімалістичні білі кросівки з натуральної шкіри. Гумова підошва, шнурівка.'],
            ['Ботильйони на товстому каблуці', 'Стильні ботильйони з квадратним носком та товстим каблуком. Замшева обробка.'],
            ['Балетки шкіряні золоті', 'Елегантні балетки з м\'якої шкіри золотистого кольору. Комфортна устілка.'],
            ['Чоботи зимові на хутрі', 'Теплі зимові чоботи з натуральним хутром всередині. Підошва антиковзна.'],
            ['Сандалі платформа', 'Яскраві сандалі на масивній платформі 6 см. Регульовані ремінці.'],
            ['Мюлі замшеві коричневі', 'Трендові замшеві мюлі на невисокому підборі. Відкритий задник, квадратний носок.'],
        ],
        'Взуття чоловіче' => [
            ['Черевики дербі шкіряні', 'Класичні шкіряні черевики-дербі ручної роботи. Підошва з натуральної шкіри.'],
            ['Кросівки бігові технологічні', 'Професійні бігові кросівки з амортизуючою підошвою. Легкий верх з сітки.'],
            ['Мокасини замшеві', 'Зручні замшеві мокасини без шнурків. Підходять для офісу та прогулянок.'],
            ['Черевики зимові термо', 'Зимові черевики з термоізоляцією. Водонепроникна мембрана, підошва Vibram.'],
        ],
        'Аксесуари' => [
            ['Сумка шкіряна тоут велика', 'Просторна шкіряна сумка-тоут з кількома відділеннями та знімним плечовим ременем.'],
            ['Ремінь шкіряний автоматичний', 'Ремінь з натуральної шкіри з автоматичною пряжкою. Ширина 3.5 см.'],
            ['Гаманець жіночий з монетницею', 'Компактний жіночий гаманець з відділенням для монет та 8 кишенями для карток.'],
            ['Окуляри сонцезахисні авіатор', 'Класичні окуляри-авіатор зі скляними лінзами UV400. Золота металева оправа.'],
            ['Шарф кашеміровий великий', 'Великий кашеміровий шарф 200×70 см. Ідеально м\'який, тримає тепло.'],
            ['Рюкзак міський 20L', 'Міський рюкзак об\'ємом 20 літрів. Відділення для ноутбука, бічні кишені для пляшок.'],
            ['Капелюх соломяний з полями', 'Літній солом\'яний капелюх з широкими полями. Захист від сонця SPF50+.'],
            ['Браслет срібний із шармами', 'Срібний браслет з набором шармів на вибір. Проба 925, регульована довжина.'],
            ['Пояс-сумка шкіряна', 'Стильна пояс-сумка з натуральної шкіри з двома відділеннями.'],
        ],
        'Дитячий одяг' => [
            ['Комбінезон зимовий 86-92', 'Теплий зимовий комбінезон для малюків. Наповнювач синтепон, знімний капюшон.'],
            ['Піжама дитяча з динозаврами', 'М\'яка фланелева піжама з принтом динозаврів. Є в розмірах 98-128.'],
            ['Платтячко на випускний', 'Ніжне святкове плаття з пишною спідницею та бантом на спині. Розміри 92-122.'],
            ['Джинси для хлопчика регульовані', 'Зручні джинси з регульованим поясом на гумці. 100% бавовна.'],
            ['Куртка демісезонна дитяча', 'Легка непромокальна куртка для весни та осені. Відбивачі для безпеки.'],
            ['Кеди дитячі на липучках', 'Зручні кеди без шнурків на липучках. Легко вдягати самостійно.'],
        ],
        'Спортивний одяг' => [
            ['Легінси для йоги безшовні', 'Безшовні легінси з ефектом пуш-ап. Тканина не просвічується, тягнеться в 4 сторони.'],
            ['Топ спортивний з підтримкою', 'Спортивний топ з вбудованим бюстгальтером рівня підтримки Medium. Вологовідвідний.'],
            ['Олімпійка зі смугами', 'Класична олімпійка з трьома смугами. Поліестер+бавовна. Для бігу та прогулянок.'],
            ['Штани спортивні зі стрілками', 'Елегантні спортивні штани з акцентними стрілками. Утяжка на манжетах.'],
            ['Куртка для бігу світловідбивна', 'Ультралегка бігова куртка з безліччю світловідбиваючих елементів. Склад: 100% нейлон.'],
            ['Рукавички спортивні для залу', 'Тренувальні рукавички з відкритими пальцями. Амортизуюча долоня, вентиляційні отвори.'],
        ],
        'Домашній одяг' => [
            ['Піжама шовкова жіноча', 'Розкішна піжама з натурального шовку. Штани з еластичним поясом, сорочка на гудзиках.'],
            ['Халат махровий з вишивкою', 'Пухнастий махровий халат з вишитою монограмою. 100% бавовна, щільність 450 г/м².'],
            ['Тапочки з відкритим носком', 'М\'які домашні тапочки з натуральної вовни. Анатомічна устілка, нековзна підошва.'],
            ['Плед флісовий двосторонній', 'Великий двосторонній плед 200×220 см. Одна сторона гладка, інша — пухнаста.'],
        ],
    ];

    public function run(): void
    {
        $workspaces = Workspace::all();

        if ($workspaces->isEmpty()) {
            $this->command->warn('No workspaces found. Skipping ProductSeeder.');
            return;
        }

        $allProducts = [];
        foreach ($this->categories as $items) {
            foreach ($items as [$name, $description]) {
                $allProducts[] = ['name' => $name, 'description' => $description];
            }
        }
        shuffle($allProducts);

        $currencies = ['UAH', 'UAH', 'UAH', 'USD', 'EUR'];
        $statuses   = ['draft', 'draft', 'active', 'active', 'active', 'active', 'archived'];

        $count = 0;

        foreach ($workspaces as $workspace) {
            $workspaceProducts = array_slice($allProducts, 0, 100);
            shuffle($workspaceProducts);

            foreach ($workspaceProducts as $item) {
                $currency = $currencies[array_rand($currencies)];
                $price    = match ($currency) {
                    'UAH'   => round(mt_rand(199, 12999) / 10) * 10 - 1,   // 199, 999, 2999 …
                    'USD'   => round(mt_rand(10, 500) / 5) * 5,
                    'EUR'   => round(mt_rand(10, 450) / 5) * 5,
                    default => 100,
                };

                $product = Product::query()->create([
                    'workspace_id' => $workspace->getKey(),
                    'sku'          => 'SKU-' . strtoupper(Str::random(8)),
                    'price'        => $price,
                    'currency'     => $currency,
                    'quantity'     => mt_rand(0, 250),
                    'status'       => $statuses[array_rand($statuses)],
                ]);

                ProductTranslation::query()->create([
                    'product_id'  => $product->getKey(),
                    'locale'      => 'uk',
                    'name'        => $item['name'] . ' ' . $this->randomSuffix(),
                    'description' => '<p>' . $item['description'] . '</p><ul><li>Висока якість матеріалів</li><li>Сертифіковано в Україні</li><li>Безкоштовна доставка від 1500 грн</li></ul>',
                ]);

                $count++;
            }
        }

        $this->command->info("Created {$count} products across {$workspaces->count()} workspace(s).");
    }

    private function randomSuffix(): string
    {
        $colors  = ['чорний', 'білий', 'бежевий', 'сірий', 'синій', 'червоний', 'зелений', 'рожевий', 'коричневий', 'хакі'];
        $sizes   = ['XS', 'S', 'M', 'L', 'XL', 'XXL', '36', '38', '40', '42'];

        return '(' . $colors[array_rand($colors)] . ', ' . $sizes[array_rand($sizes)] . ')';
    }
}
